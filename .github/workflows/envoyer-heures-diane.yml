name: Envoyer les heures à Diane

on:
  push:
    branches:
      - main           # déclenché à chaque push sur la branche main

jobs:
  send-email:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Récupérer le nom de l'employé (auteur du dernier commit)
        run: |
          EMPLOYEE_NAME="$(git log -1 --pretty=format:'%an')"
          echo "EMPLOYEE_NAME=$EMPLOYEE_NAME" >> $GITHUB_ENV

      - name: Envoyer les heures par courriel à Diane
        uses: dawidd6/action-send-mail@v3
        with:
          server: ${{ secrets.SMTP_SERVER }}
          port: ${{ secrets.SMTP_PORT }}
          username: ${{ secrets.SMTP_USERNAME }}
          password: ${{ secrets.SMTP_PASSWORD }}
          secure: true
          to: ${{ secrets.DIANE_EMAIL }}
          from: "Agent RH Construction <${{ secrets.SMTP_USERNAME }}>"
          subject: "Heures de la semaine – ${{ env.EMPLOYEE_NAME }}"
          body: |
            Bonjour Diane,

            Les heures de la semaine pour ${{ env.EMPLOYEE_NAME }} ont été soumises.
            Ce courriel a été envoyé automatiquement par l'agent RH (GitHub Actions).

            Merci,
            Agent RH Construction Québec
          # Tous les fichiers PDF du dépôt seront joints (par ex. les rapports d'heures)
          attachments: |
            **/*.pdf

